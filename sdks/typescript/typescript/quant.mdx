---
title: '量化分析'
description: 'TypeScript SDK 量化分析模块 - 技术指标、因子、行情和回测'
icon: 'chart-mixed'
---

## 概述

量化分析模块提供以下功能：
- **技术指标** - MA, RSI, MACD, 布林带等
- **因子数据** - 动量、价值、质量、规模等因子
- **行情数据** - 实时行情和历史 OHLCV
- **回测引擎** - 策略回测和绩效分析

---

## 技术指标

### indicators()

获取技术指标数据。

```typescript
const data = await client.quant.indicators({
  symbols: ['US:AAPL', 'US:MSFT'],
  indicators: ['ma', 'rsi', 'macd'],
  startDate: '2024-01-01',
  params: { ma_period: 20, rsi_period: 14 }
});
```

<ParamField path="params.symbols" type="string[]" required>
  股票代码列表，格式：`市场:代码`
</ParamField>

<ParamField path="params.indicators" type="string[]" required>
  指标名称列表，如 `ma`, `rsi`, `macd`, `bollinger`, `atr`, `obv`
</ParamField>

<ParamField path="params.startDate" type="string">
  开始日期 (YYYY-MM-DD)
</ParamField>

<ParamField path="params.endDate" type="string">
  结束日期 (YYYY-MM-DD)
</ParamField>

<ParamField path="params.interval" type="string" default="1d">
  数据周期：`1d`, `1w`, `1m`
</ParamField>

<ParamField path="params.params" type="object">
  指标参数
</ParamField>

---

### indicatorList()

获取可用指标列表。

```typescript
const indicators = await client.quant.indicatorList();
indicators.forEach(ind => {
  console.log(`${ind.name}: ${ind.description}`);
});
```

---

## 因子数据

### factors()

获取因子数据。

```typescript
const data = await client.quant.factors({
  symbols: ['US:AAPL', 'US:MSFT', 'US:GOOGL'],
  factors: ['momentum', 'value', 'quality'],
  frequency: 'monthly'
});
```

<ParamField path="params.symbols" type="string[]" required>
  股票代码列表
</ParamField>

<ParamField path="params.factors" type="string[]" required>
  因子名称列表
</ParamField>

<ParamField path="params.startDate" type="string">
  开始日期
</ParamField>

<ParamField path="params.endDate" type="string">
  结束日期
</ParamField>

<ParamField path="params.frequency" type="string" default="daily">
  数据频率：`daily`, `weekly`, `monthly`
</ParamField>

---

### factorExposure()

获取因子暴露度。

```typescript
const exposure = await client.quant.factorExposure(
  ['US:AAPL', 'US:GOOGL', 'US:TSLA']
);
exposure.forEach(e => {
  console.log(`${e.symbol}: momentum=${e.momentum}, value=${e.value}`);
});
```

<ParamField path="symbols" type="string[]" required>
  股票代码列表
</ParamField>

<ParamField path="date" type="string">
  指定日期，默认最新
</ParamField>

---

### factorList()

获取可用因子列表。

```typescript
const factors = await client.quant.factorList();
```

---

## 行情数据

### quotes()

获取实时行情。

```typescript
const quotes = await client.quant.quotes({
  symbols: ['US:AAPL', 'US:MSFT', 'US:GOOGL']
});

quotes.forEach(q => {
  console.log(`${q.symbol}: $${q.price} (${q.changePercent > 0 ? '+' : ''}${q.changePercent.toFixed(2)}%)`);
});
```

<ParamField path="params.symbols" type="string[]" required>
  股票代码列表
</ParamField>

<ParamField path="params.fields" type="string[]">
  指定返回字段
</ParamField>

---

### quotesHistory()

获取历史行情数据。

```typescript
const history = await client.quant.quotesHistory({
  symbols: ['US:AAPL'],
  startDate: '2024-01-01',
  endDate: '2024-06-30',
  interval: '1d',
  adjust: 'forward'
});
```

<ParamField path="params.symbols" type="string[]" required>
  股票代码列表
</ParamField>

<ParamField path="params.startDate" type="string">
  开始日期
</ParamField>

<ParamField path="params.endDate" type="string">
  结束日期
</ParamField>

<ParamField path="params.interval" type="string" default="1d">
  数据周期：`1d`, `1w`, `1m`
</ParamField>

<ParamField path="params.adjust" type="string" default="forward">
  复权类型：`forward`, `backward`, `none`
</ParamField>

<ParamField path="params.limit" type="number" default="100">
  每个股票返回的最大记录数
</ParamField>

---

## 回测

### backtest()

运行策略回测。

```typescript
const result = await client.quant.backtest({
  strategy: {
    type: 'momentum',
    universe: ['US:AAPL', 'US:MSFT', 'US:GOOGL', 'US:AMZN', 'US:META'],
    rebalance: 'monthly',
    top_n: 3,
    lookback: 60  // 60天动量
  },
  startDate: '2020-01-01',
  endDate: '2024-01-01',
  initialCapital: 1000000,
  benchmark: 'US:SPY'
});

console.log(`Total Return: ${(result.metrics!.totalReturn * 100).toFixed(2)}%`);
console.log(`Sharpe Ratio: ${result.metrics!.sharpeRatio.toFixed(2)}`);
console.log(`Max Drawdown: ${(result.metrics!.maxDrawdown * 100).toFixed(2)}%`);
```

<ParamField path="params.strategy" type="BacktestStrategy" required>
  策略配置
</ParamField>

<ParamField path="params.startDate" type="string" required>
  回测开始日期
</ParamField>

<ParamField path="params.endDate" type="string" required>
  回测结束日期
</ParamField>

<ParamField path="params.initialCapital" type="number" default="1000000">
  初始资金
</ParamField>

<ParamField path="params.benchmark" type="string">
  基准标的
</ParamField>

---

### backtestResult()

获取回测结果。

```typescript
const result = await client.quant.backtestResult('bt_abc123');
console.log(result.metrics);
```

---

### backtestReturns()

获取回测收益序列。

```typescript
const returns = await client.quant.backtestReturns('bt_abc123');
returns.forEach(r => {
  console.log(`${r.date}: ${(r.cumulativeReturn * 100).toFixed(2)}%`);
});
```

---

### backtestTrades()

获取回测交易记录。

```typescript
const trades = await client.quant.backtestTrades('bt_abc123');
trades.forEach(t => {
  console.log(`${t.date} ${t.action.toUpperCase()} ${t.quantity} ${t.symbol} @ $${t.price}`);
});
```

---

## 类型定义

```typescript
interface IndicatorParams {
  symbols: string[];
  indicators: string[];
  startDate?: string;
  endDate?: string;
  interval?: '1d' | '1w' | '1m';
  params?: Record<string, unknown>;
}

interface BacktestStrategy {
  type: string;
  universe: string[];
  rebalance?: 'daily' | 'weekly' | 'monthly' | 'quarterly';
  [key: string]: unknown;
}

interface BacktestMetrics {
  totalReturn: number;
  annualizedReturn: number;
  sharpeRatio: number;
  maxDrawdown: number;
  winRate: number;
  volatility: number;
}

interface QuoteData {
  symbol: string;
  price: number;
  change: number;
  changePercent: number;
  volume: number;
  high: number;
  low: number;
  open: number;
  previousClose: number;
}
```

---

## 完整示例

```typescript
import { Reportify } from 'reportify-sdk';

const client = new Reportify({ apiKey: 'your-api-key' });

async function quantAnalysis() {
  // 1. 获取技术指标
  const indicators = await client.quant.indicators({
    symbols: ['US:AAPL'],
    indicators: ['ma', 'rsi'],
    startDate: '2024-01-01',
    params: { ma_period: 20 }
  });
  console.log('Indicators:', indicators.slice(0, 5));

  // 2. 获取因子暴露
  const exposure = await client.quant.factorExposure(['US:AAPL', 'US:GOOGL']);
  console.log('Factor Exposure:', exposure);

  // 3. 获取实时行情
  const quotes = await client.quant.quotes({
    symbols: ['US:AAPL', 'US:MSFT']
  });
  quotes.forEach(q => {
    console.log(`${q.symbol}: $${q.price}`);
  });

  // 4. 运行回测
  const result = await client.quant.backtest({
    strategy: {
      type: 'momentum',
      universe: ['US:AAPL', 'US:MSFT', 'US:GOOGL'],
      rebalance: 'monthly',
      top_n: 2
    },
    startDate: '2022-01-01',
    endDate: '2024-01-01',
    benchmark: 'US:SPY'
  });

  if (result.metrics) {
    console.log(`Total Return: ${(result.metrics.totalReturn * 100).toFixed(2)}%`);
    console.log(`Sharpe Ratio: ${result.metrics.sharpeRatio.toFixed(2)}`);
  }
}

quantAnalysis();
```
