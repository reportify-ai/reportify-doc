---
title: '策略回测'
description: '运行量化策略回测并获取绩效分析'
api: 'POST /v1/quant/backtest'
---

## 运行策略回测

执行策略回测，返回绩效指标和交易记录。

```bash
POST /v1/quant/backtest
```

<CodeGroup>

```bash cURL
curl -X POST https://api.reportify.cn/v1/quant/backtest \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "start_date": "2024-01-01",
    "end_date": "2025-01-01",
    "market": "cn",
    "symbol": "000001",
    "formula": "CROSS(MA(5), MA(10))",
    "initial_cash": 100000,
    "commission": 0.0003,
    "sizer_percent": 99
  }'
```

```python Python
import requests

response = requests.post(
    "https://api.reportify.cn/v1/quant/backtest",
    headers={"Authorization": "Bearer <token>"},
    json={
        "start_date": "2024-01-01",
        "end_date": "2025-01-01",
        "market": "cn",
        "symbol": "000001",
        "formula": "CROSS(MA(5), MA(10))",
        "initial_cash": 100000,
        "commission": 0.0003,
        "sizer_percent": 99
    }
)
print(response.json())
```

```typescript TypeScript
const response = await fetch('https://api.reportify.cn/v1/quant/backtest', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer <token>',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    start_date: '2024-01-01',
    end_date: '2025-01-01',
    market: 'cn',
    symbol: '000001',
    formula: 'CROSS(MA(5), MA(10))',
    initial_cash: 100000,
    commission: 0.0003,
    sizer_percent: 99
  })
});
const data = await response.json();
```

</CodeGroup>

### 请求参数

<ParamField body="start_date" type="string" required>
  回测开始日期，格式：`YYYY-MM-DD`
</ParamField>

<ParamField body="end_date" type="string" required>
  回测结束日期，格式：`YYYY-MM-DD`
</ParamField>

<ParamField body="market" type="string" default="cn">
  股票市场：`cn`（A股）, `hk`（港股）, `us`（美股）
</ParamField>

<ParamField body="symbol" type="string" required>
  股票代码
</ParamField>

<ParamField body="formula" type="string" required>
  交易策略公式，当公式为真时买入
  
  <Expandable title="公式示例">
    - `CROSS(MA(5), MA(10))` - 均线金叉买入
    - `RSI(14) < 30` - RSI 超卖买入
    - `CLOSE > BOLL(20, 2).upper` - 突破布林带上轨买入
    - `(RSI(14) < 30) & (CLOSE > MA(20))` - 组合条件
  </Expandable>
</ParamField>

<ParamField body="initial_cash" type="number" default="100000">
  初始资金（元）
</ParamField>

<ParamField body="commission" type="number" default="0">
  佣金费率（如 0.0003 表示万三）
</ParamField>

<ParamField body="stop_loss" type="number" default="0">
  止损比例（如 0.1 表示 10% 止损，0 表示不止损）
</ParamField>

<ParamField body="sizer_percent" type="integer" default="99">
  仓位百分比（1-100，99 表示每次买入使用 99% 资金）
</ParamField>

<ParamField body="auto_close" type="boolean" default="true">
  是否在回测结束时自动平仓
</ParamField>

### 响应参数

<ResponseField name="success" type="boolean">
  回测是否成功
</ResponseField>

<ResponseField name="initial_cash" type="number">
  初始资金
</ResponseField>

<ResponseField name="final_cash" type="number">
  最终资金
</ResponseField>

<ResponseField name="total_return" type="number">
  总收益（元）
</ResponseField>

<ResponseField name="total_return_pct" type="number">
  总收益率（如 0.156 表示 15.6%）
</ResponseField>

<ResponseField name="max_drawdown" type="number">
  最大回撤（如 -0.082 表示 -8.2%）
</ResponseField>

<ResponseField name="profit_factor" type="number">
  盈利因子（总盈利 / 总亏损）
</ResponseField>

<ResponseField name="win_rate" type="number">
  胜率（如 0.65 表示 65%）
</ResponseField>

<ResponseField name="total_trades" type="integer">
  总交易次数
</ResponseField>

<ResponseField name="trades" type="array">
  交易详情列表
  
  <Expandable title="Trade 字段">
    - `date`: 交易日期
    - `action`: 交易动作（`buy` 或 `sell`）
    - `price`: 成交价格
    - `size`: 成交数量
    - `value`: 成交金额
    - `commission`: 佣金
    - `pnl`: 盈亏（卖出时）
    - `pnl_pct`: 盈亏比例
  </Expandable>
</ResponseField>

### 响应示例

```json
{
  "success": true,
  "initial_cash": 100000,
  "final_cash": 115600,
  "total_return": 15600,
  "total_return_pct": 0.156,
  "max_drawdown": -0.082,
  "profit_factor": 2.35,
  "win_rate": 0.65,
  "total_trades": 12,
  "trades": [
    {
      "date": "2024-01-15",
      "action": "buy",
      "price": 11.25,
      "size": 8800,
      "value": 99000,
      "commission": 29.7
    },
    {
      "date": "2024-02-20",
      "action": "sell",
      "price": 12.50,
      "size": 8800,
      "value": 110000,
      "commission": 33.0,
      "pnl": 10937.3,
      "pnl_pct": 0.111
    },
    {
      "date": "2024-03-10",
      "action": "buy",
      "price": 12.00,
      "size": 9100,
      "value": 109200,
      "commission": 32.76
    },
    {
      "date": "2024-04-05",
      "action": "sell",
      "price": 11.50,
      "size": 9100,
      "value": 104650,
      "commission": 31.4,
      "pnl": -4614.16,
      "pnl_pct": -0.042
    }
  ]
}
```

---

## 策略公式示例

### 均线金叉策略

5 日均线上穿 10 日均线时买入：

```python
{
    "formula": "CROSS(MA(5), MA(10))",
    "symbol": "000001",
    "start_date": "2024-01-01",
    "end_date": "2025-01-01"
}
```

### RSI 超卖策略

RSI 低于 30 时买入：

```python
{
    "formula": "RSI(14) < 30",
    "symbol": "600519",
    "start_date": "2024-01-01",
    "end_date": "2025-01-01",
    "stop_loss": 0.1
}
```

### MACD 金叉策略

MACD DIF 上穿 DEA 时买入：

```python
{
    "formula": "CROSS(MACD().dif, MACD().dea)",
    "symbol": "000002",
    "start_date": "2024-01-01",
    "end_date": "2025-01-01"
}
```

### 布林带突破策略

价格突破布林带上轨时买入：

```python
{
    "formula": "CLOSE > BOLL(20, 2).upper",
    "symbol": "000001",
    "start_date": "2024-01-01",
    "end_date": "2025-01-01"
}
```

### 组合条件策略

RSI 超卖且价格在 20 日均线上方：

```python
{
    "formula": "(RSI(14) < 30) & (CLOSE > MA(20))",
    "symbol": "600036",
    "start_date": "2024-01-01",
    "end_date": "2025-01-01",
    "commission": 0.0003,
    "sizer_percent": 80
}
```

---

## 参数说明

### 佣金设置

| 值 | 描述 |
|----|------|
| `0` | 不计算佣金 |
| `0.0003` | 万三（0.03%） |
| `0.001` | 千一（0.1%） |

### 止损设置

| 值 | 描述 |
|----|------|
| `0` | 不设止损 |
| `0.05` | 5% 止损 |
| `0.1` | 10% 止损 |

### 仓位设置

| 值 | 描述 |
|----|------|
| `99` | 使用 99% 资金（预留部分应对价格波动） |
| `50` | 使用 50% 资金（半仓操作） |
| `30` | 使用 30% 资金（轻仓试探） |

---

## 注意事项

<Note>
- 回测结果仅供参考，历史收益不代表未来表现
- 回测未考虑滑点、冲击成本等实际交易因素
- 建议使用合理的佣金和止损参数以更接近真实交易
</Note>
